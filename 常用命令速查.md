# 📌 常用命令速查

## 🚀 服务管理

### 启动后端服务
```bash
cd /home/devbox/project/Video
pnpm dev
```

### 查看服务状态
```bash
# 检查端口占用
netstat -tlnp | grep :3000

# 健康检查
curl http://localhost:3000/api/video/health
```

### 停止服务
```bash
# 方法1：直接在终端按 Ctrl+C

# 方法2：杀死进程
pkill -f "node app.js"
```

---

## 👥 用户数据管理

### 查看用户统计
```bash
cd /home/devbox/project/Video
node scripts/checkUsers.js
```

### 数据库直接查询
```bash
# 连接数据库
mysql -h video-extract-db-mysql.ns-s63t2o94.svc -P 3306 -u root -p12345678 video_extract_db

# 查看所有用户
SELECT * FROM users;

# 查看今日新增
SELECT * FROM users WHERE DATE(created_at) = CURDATE();

# 查看今日活跃
SELECT * FROM users WHERE DATE(last_login_time) = CURDATE();

# 统计总数
SELECT COUNT(*) FROM users;
```

---

## 📊 数据统计查询

### 用户概况
```sql
-- 总用户数
SELECT COUNT(*) as total FROM users;

-- 今日新增
SELECT COUNT(*) FROM users WHERE DATE(created_at) = CURDATE();

-- 今日活跃
SELECT COUNT(*) FROM users WHERE DATE(last_login_time) = CURDATE();

-- 手机号绑定率
SELECT 
  COUNT(*) as total,
  SUM(CASE WHEN phone IS NOT NULL THEN 1 ELSE 0 END) as with_phone,
  ROUND(SUM(CASE WHEN phone IS NOT NULL THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as bind_rate
FROM users;
```

### 活跃度分析
```sql
-- 登录频率分布
SELECT 
  CASE 
    WHEN login_count = 1 THEN '1次'
    WHEN login_count BETWEEN 2 AND 5 THEN '2-5次'
    WHEN login_count BETWEEN 6 AND 10 THEN '6-10次'
    ELSE '10次以上'
  END as frequency,
  COUNT(*) as user_count
FROM users
GROUP BY frequency;

-- 最活跃用户 TOP 10
SELECT 
  id,
  LEFT(openid, 10) as openid,
  login_count,
  last_login_time
FROM users
ORDER BY login_count DESC
LIMIT 10;
```

---

## 🔧 数据库维护

### 创建用户表
```bash
cd /home/devbox/project/Video
node scripts/createUsersTable.js
```

### 备份数据库
```bash
mysqldump -h video-extract-db-mysql.ns-s63t2o94.svc \
  -P 3306 -u root -p12345678 \
  video_extract_db > backup_$(date +%Y%m%d).sql
```

### 恢复数据库
```bash
mysql -h video-extract-db-mysql.ns-s63t2o94.svc \
  -P 3306 -u root -p12345678 \
  video_extract_db < backup_20251005.sql
```

---

## 🐛 问题排查

### 查看日志
```bash
# 实时查看日志
tail -f logs/app.log

# 查看最近100行
tail -n 100 logs/app.log

# 查看错误日志
grep -i error logs/app.log
```

### 测试数据库连接
```bash
# 方法1：使用 mysql 命令
mysql -h video-extract-db-mysql.ns-s63t2o94.svc -P 3306 -u root -p12345678 -e "SELECT 1"

# 方法2：使用创建表脚本（会测试连接）
node scripts/createUsersTable.js
```

### 测试微信登录
```bash
# 使用测试脚本
node scripts/test-wechat-login.js
```

---

## 📦 依赖管理

### 安装依赖
```bash
cd /home/devbox/project/Video
pnpm install
```

### 更新依赖
```bash
pnpm update
```

### 查看依赖版本
```bash
pnpm list
```

---

## 🔑 环境变量

### 查看当前配置
```bash
cd /home/devbox/project/Video
cat .env
```

### 重要配置项
```bash
# 服务器配置
PORT=3000
HOST=0.0.0.0

# 数据库配置
DB_HOST=video-extract-db-mysql.ns-s63t2o94.svc
DB_PORT=3306
DB_USER=root
DB_PASSWORD=12345678
DB_NAME=video_extract_db

# 微信小程序配置
WX_APPID=wx638ec29150825d0d
WX_APPSECRET=e1a2edb85223deb70257809c59fc1b54

# JWT配置
JWT_SECRET=your_jwt_secret_key_here
```

---

## 🌐 API 测试

### 健康检查
```bash
curl http://localhost:3000/api/video/health
```

### 测试登录接口
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "loginCode": "test_code",
    "phoneCode": null
  }'
```

---

## 📱 小程序开发

### 编译小程序
```bash
# 在微信开发者工具中
1. 打开项目目录: /home/devbox/project/Video/miniprogram
2. 点击"编译"按钮
3. 在模拟器中测试
```

### 上传代码
```bash
# 在微信开发者工具中
1. 点击"上传"按钮
2. 填写版本号和项目备注
3. 确认上传
```

---

## 🎯 快速命令

### 一键启动开发环境
```bash
cd /home/devbox/project/Video && pnpm dev
```

### 一键查看用户数据
```bash
cd /home/devbox/project/Video && node scripts/checkUsers.js
```

### 一键健康检查
```bash
curl -s http://localhost:3000/api/video/health | python3 -m json.tool
```

---

## 📚 相关文档

- `✅_快速登录功能完成总结.md` - 功能完成总结
- `个人小程序快速登录指南.md` - 快速登录详细说明
- `用户信息记录说明.md` - 用户数据记录机制
- `微信手机号登录完整指南.md` - 企业小程序扩展功能

---

**更新时间**: 2025-10-05  
**版本**: v1.0.0
