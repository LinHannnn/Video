# 数据库配置指南

## 当前问题
您遇到的错误：`Access denied for user 'root'@'localhost' (using password: YES)` 

这表示MySQL数据库的用户名或密码不正确。

## 🚀 快速解决方案

### 方案1：跳过数据库启动（推荐用于测试）

```bash
# 跳过数据库连接，先测试API服务
pnpm dev --skip-db

# 或者设置环境变量
SKIP_DATABASE=true pnpm dev
```

这样可以先启动服务测试基本功能，密钥管理功能将不可用。

### 方案2：修复数据库连接

#### 2.1 检查MySQL服务状态

```bash
# Windows - 检查MySQL服务
net start | findstr -i mysql

# 如果没有运行，启动MySQL
net start mysql
```

#### 2.2 重置MySQL密码

**方法A：通过MySQL命令行**
```bash
# 1. 连接到MySQL（如果你知道当前密码）
mysql -u root -p

# 2. 如果忘记密码，重置密码
# 首先停止MySQL服务
net stop mysql

# 启动MySQL（跳过权限验证）
mysqld --skip-grant-tables --skip-networking

# 新开终端，连接MySQL
mysql -u root

# 重置密码
USE mysql;
UPDATE user SET authentication_string=PASSWORD('12345678@') WHERE User='root';
FLUSH PRIVILEGES;
EXIT;

# 正常重启MySQL
net start mysql
```

**方法B：使用MySQL Workbench或phpMyAdmin**
- 打开MySQL Workbench或phpMyAdmin
- 使用管理员账号登录
- 修改root用户密码为 `12345678@`

#### 2.3 创建数据库

```sql
-- 连接MySQL后执行
CREATE DATABASE video_extract_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 验证数据库创建成功
SHOW DATABASES;
```

#### 2.4 更新配置文件

编辑 `.env` 文件：
```env
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=你的实际密码
DB_NAME=video_extract_db
```

## 🔧 其他常见问题

### 问题1：MySQL服务未安装
**Windows安装MySQL：**
1. 下载MySQL Installer：https://dev.mysql.com/downloads/installer/
2. 安装时设置root密码为 `12345678@`
3. 确保安装为Windows服务

**或使用XAMPP：**
1. 下载XAMPP：https://www.apachefriends.org/
2. 安装后启动MySQL服务
3. 默认用户名：root，密码：空（需要设置）

### 问题2：端口冲突
如果3306端口被占用：
```bash
# 检查端口占用
netstat -ano | findstr :3306

# 在.env中修改端口
DB_PORT=3307
```

### 问题3：权限问题
```sql
-- 给root用户所有权限
GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION;
FLUSH PRIVILEGES;
```

## 📋 验证步骤

### 1. 测试数据库连接
```bash
mysql -u root -p -h localhost
# 输入密码：12345678@
```

### 2. 验证数据库存在
```sql
USE video_extract_db;
SHOW TABLES;
```

### 3. 重启服务
```bash
pnpm dev
```

### 4. 检查健康状态
访问：http://localhost:3000/api/video/health

应该看到：
```json
{
  "code": 200,
  "data": {
    "status": "healthy",
    "database": "connected",
    "features": {
      "video_parsing": true,
      "key_management": true
    }
  }
}
```

## 🆘 仍然无法解决？

### 临时解决方案：使用SQLite
如果MySQL配置太复杂，我们可以创建一个SQLite版本：

```bash
# 安装SQLite依赖
pnpm add sqlite3

# 使用SQLite模式启动
SQLITE_MODE=true pnpm dev
```

### 联系支持
如果问题持续存在，请提供：
1. 操作系统版本
2. MySQL版本
3. 错误日志截图
4. 是否已安装MySQL

---

💡 **建议顺序：**
1. 先用 `--skip-db` 参数测试API功能
2. 再配置MySQL数据库
3. 最后测试完整功能 