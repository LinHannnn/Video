# ğŸ“‹ å…¬å‘Šæ¥å£æµ‹è¯•æŒ‡å—

## âœ… æµ‹è¯•ç»“æœ

æ‰€æœ‰æ¥å£ç»æµ‹è¯•**å®Œå…¨æ­£å¸¸**ï¼ä»¥ä¸‹æ˜¯æµ‹è¯•ç¤ºä¾‹å’Œç»“æœã€‚

---

## ğŸ§ª æ¥å£æµ‹è¯•

### 1. è·å–æœ‰æ•ˆå…¬å‘Šï¼ˆå‰ç«¯ä½¿ç”¨ï¼‰

**æ¥å£**: `GET /api/announcements/active`

**æµ‹è¯•å‘½ä»¤**:
```bash
curl http://localhost:3000/api/announcements/active
```

**é¢„æœŸç»“æœ**: åªè¿”å›çŠ¶æ€ä¸º1ï¼ˆå¯ç”¨ï¼‰çš„å…¬å‘Š
```json
{
  "code": 200,
  "msg": "è·å–æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "content": "ğŸ‰ æ¬¢è¿ä½¿ç”¨è§†é¢‘è§£æå°ç¨‹åºï¼",
      "priority": 10
    },
    {
      "id": 2,
      "content": "ğŸ“¢ ç™»å½•åå³å¯ä½¿ç”¨å…¨éƒ¨åŠŸèƒ½ï¼",
      "priority": 5
    }
  ]
}
```

âœ… **æµ‹è¯•é€šè¿‡**

---

### 2. åˆ›å»ºå…¬å‘Š

**æ¥å£**: `POST /api/announcements`

**æµ‹è¯•å‘½ä»¤**:
```bash
curl -X POST http://localhost:3000/api/announcements \
  -H "Content-Type: application/json" \
  -d '{
    "content": "æµ‹è¯•å…¬å‘Š",
    "status": 1,
    "priority": 20
  }'
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "msg": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 3
  }
}
```

âœ… **æµ‹è¯•é€šè¿‡**

---

### 3. ç¦ç”¨å…¬å‘Šï¼ˆå•ä¸ªï¼‰

**æ¥å£**: `PUT /api/announcements/:id`

**æµ‹è¯•å‘½ä»¤**:
```bash
curl -X PUT http://localhost:3000/api/announcements/1 \
  -H "Content-Type: application/json" \
  -d '{"status": 0}'
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "msg": "æ›´æ–°æˆåŠŸ"
}
```

âœ… **æµ‹è¯•é€šè¿‡**

**éªŒè¯**: å†æ¬¡è°ƒç”¨ `/api/announcements/active`ï¼ŒIDä¸º1çš„å…¬å‘Šåº”è¯¥ä¸å†å‡ºç°

---

### 4. å¯ç”¨å…¬å‘Šï¼ˆå•ä¸ªï¼‰

**æ¥å£**: `PUT /api/announcements/:id`

**æµ‹è¯•å‘½ä»¤**:
```bash
curl -X PUT http://localhost:3000/api/announcements/1 \
  -H "Content-Type: application/json" \
  -d '{"status": 1}'
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "msg": "æ›´æ–°æˆåŠŸ"
}
```

âœ… **æµ‹è¯•é€šè¿‡**

---

### 5. æ‰¹é‡ç¦ç”¨å…¬å‘Š

**æ¥å£**: `POST /api/announcements/batch/status`

**æµ‹è¯•å‘½ä»¤**:
```bash
curl -X POST http://localhost:3000/api/announcements/batch/status \
  -H "Content-Type: application/json" \
  -d '{
    "ids": [1, 2],
    "status": 0
  }'
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "msg": "æ›´æ–°æˆåŠŸ",
  "data": {
    "affectedRows": 2
  }
}
```

âœ… **æµ‹è¯•é€šè¿‡**

---

### 6. æ‰¹é‡å¯ç”¨å…¬å‘Š

**æ¥å£**: `POST /api/announcements/batch/status`

**æµ‹è¯•å‘½ä»¤**:
```bash
curl -X POST http://localhost:3000/api/announcements/batch/status \
  -H "Content-Type: application/json" \
  -d '{
    "ids": [1, 2],
    "status": 1
  }'
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "msg": "æ›´æ–°æˆåŠŸ",
  "data": {
    "affectedRows": 2
  }
}
```

âœ… **æµ‹è¯•é€šè¿‡**

---

### 7. æŸ¥çœ‹æ‰€æœ‰å…¬å‘Šï¼ˆåŒ…æ‹¬ç¦ç”¨çš„ï¼‰

**æ¥å£**: `GET /api/announcements`

**æµ‹è¯•å‘½ä»¤**:
```bash
curl http://localhost:3000/api/announcements
```

**é¢„æœŸç»“æœ**: è¿”å›æ‰€æœ‰å…¬å‘Šï¼ŒåŒ…æ‹¬ç¦ç”¨çš„
```json
{
  "code": 200,
  "msg": "è·å–æˆåŠŸ",
  "data": {
    "list": [
      {
        "id": 1,
        "content": "...",
        "status": 0,  // 0=ç¦ç”¨, 1=å¯ç”¨
        "priority": 10
      }
    ],
    "total": 2,
    "page": 1,
    "limit": 10
  }
}
```

âœ… **æµ‹è¯•é€šè¿‡**

---

### 8. åˆ é™¤å…¬å‘Š

**æ¥å£**: `DELETE /api/announcements/:id`

**æµ‹è¯•å‘½ä»¤**:
```bash
curl -X DELETE http://localhost:3000/api/announcements/3
```

**é¢„æœŸç»“æœ**:
```json
{
  "code": 200,
  "msg": "åˆ é™¤æˆåŠŸ"
}
```

âœ… **æµ‹è¯•é€šè¿‡**

---

## ğŸ” å®Œæ•´æµ‹è¯•æµç¨‹

### æµ‹è¯•è„šæœ¬

åˆ›å»ºä¸€ä¸ªæµ‹è¯•è„šæœ¬ `test-announcements.sh`ï¼š

```bash
#!/bin/bash

echo "========================================"
echo "å…¬å‘Šæ¥å£å®Œæ•´æµ‹è¯•"
echo "========================================"
echo

# 1. è·å–æœ‰æ•ˆå…¬å‘Š
echo "[1/8] æµ‹è¯•ï¼šè·å–æœ‰æ•ˆå…¬å‘Š"
curl -s http://localhost:3000/api/announcements/active | python3 -m json.tool
echo
echo

# 2. åˆ›å»ºå…¬å‘Š
echo "[2/8] æµ‹è¯•ï¼šåˆ›å»ºå…¬å‘Š"
curl -s -X POST http://localhost:3000/api/announcements \
  -H "Content-Type: application/json" \
  -d '{"content":"æµ‹è¯•å…¬å‘Š","status":1,"priority":50}' | python3 -m json.tool
echo
echo

# 3. ç¦ç”¨å…¬å‘Šï¼ˆID=1ï¼‰
echo "[3/8] æµ‹è¯•ï¼šç¦ç”¨å…¬å‘Š"
curl -s -X PUT http://localhost:3000/api/announcements/1 \
  -H "Content-Type: application/json" \
  -d '{"status":0}' | python3 -m json.tool
echo
echo

# 4. éªŒè¯ç¦ç”¨æ•ˆæœ
echo "[4/8] éªŒè¯ï¼šç¦ç”¨åçš„æœ‰æ•ˆå…¬å‘Šåˆ—è¡¨"
curl -s http://localhost:3000/api/announcements/active | python3 -m json.tool
echo
echo

# 5. å¯ç”¨å…¬å‘Š
echo "[5/8] æµ‹è¯•ï¼šå¯ç”¨å…¬å‘Š"
curl -s -X PUT http://localhost:3000/api/announcements/1 \
  -H "Content-Type: application/json" \
  -d '{"status":1}' | python3 -m json.tool
echo
echo

# 6. æ‰¹é‡ç¦ç”¨
echo "[6/8] æµ‹è¯•ï¼šæ‰¹é‡ç¦ç”¨å…¬å‘Š"
curl -s -X POST http://localhost:3000/api/announcements/batch/status \
  -H "Content-Type: application/json" \
  -d '{"ids":[1,2],"status":0}' | python3 -m json.tool
echo
echo

# 7. æ‰¹é‡å¯ç”¨
echo "[7/8] æµ‹è¯•ï¼šæ‰¹é‡å¯ç”¨å…¬å‘Š"
curl -s -X POST http://localhost:3000/api/announcements/batch/status \
  -H "Content-Type: application/json" \
  -d '{"ids":[1,2],"status":1}' | python3 -m json.tool
echo
echo

# 8. æŸ¥çœ‹æ‰€æœ‰å…¬å‘Š
echo "[8/8] æŸ¥çœ‹æ‰€æœ‰å…¬å‘Šï¼ˆå«ç¦ç”¨ï¼‰"
curl -s http://localhost:3000/api/announcements | python3 -m json.tool
echo

echo "========================================"
echo "âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ"
echo "========================================"
```

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
chmod +x test-announcements.sh
./test-announcements.sh
```

---

## ğŸ“Š æ•°æ®åº“éªŒè¯

### æŸ¥çœ‹å…¬å‘ŠçŠ¶æ€

```sql
-- æŸ¥çœ‹æ‰€æœ‰å…¬å‘ŠåŠå…¶çŠ¶æ€
SELECT 
  id,
  LEFT(content, 30) as content_preview,
  status,
  CASE status 
    WHEN 1 THEN 'å¯ç”¨'
    WHEN 0 THEN 'ç¦ç”¨'
  END as status_text,
  priority
FROM announcements
ORDER BY priority DESC;
```

### æ‰‹åŠ¨æ›´æ–°çŠ¶æ€

```sql
-- ç¦ç”¨å…¬å‘Š
UPDATE announcements SET status = 0 WHERE id = 1;

-- å¯ç”¨å…¬å‘Š
UPDATE announcements SET status = 1 WHERE id = 1;

-- æ‰¹é‡ç¦ç”¨
UPDATE announcements SET status = 0 WHERE id IN (1, 2, 3);

-- æ‰¹é‡å¯ç”¨
UPDATE announcements SET status = 1 WHERE id IN (1, 2, 3);
```

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### 1. æµ‹è¯•ç¦ç”¨åŠŸèƒ½

```bash
# æ­¥éª¤1ï¼šç¦ç”¨å…¬å‘Š
curl -X PUT http://localhost:3000/api/announcements/1 \
  -H "Content-Type: application/json" \
  -d '{"status": 0}'

# æ­¥éª¤2ï¼šéªŒè¯å‰ç«¯ä¸å†æ˜¾ç¤º
curl http://localhost:3000/api/announcements/active

# æ­¥éª¤3ï¼šé‡æ–°å¯ç”¨
curl -X PUT http://localhost:3000/api/announcements/1 \
  -H "Content-Type: application/json" \
  -d '{"status": 1}'
```

### 2. æ‰¹é‡ç®¡ç†

```bash
# ä¸€æ¬¡æ€§ç¦ç”¨å¤šä¸ªå…¬å‘Š
curl -X POST http://localhost:3000/api/announcements/batch/status \
  -H "Content-Type: application/json" \
  -d '{"ids": [1, 2, 3], "status": 0}'

# ä¸€æ¬¡æ€§å¯ç”¨å¤šä¸ªå…¬å‘Š
curl -X POST http://localhost:3000/api/announcements/batch/status \
  -H "Content-Type: application/json" \
  -d '{"ids": [1, 2, 3], "status": 1}'
```

---

## ğŸ› é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šæ¥å£è¿”å›404

**åŸå› **: è·¯ç”±æœªæ­£ç¡®æ³¨å†Œ

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨è·¯ç”±
curl http://localhost:3000/api
```

**è§£å†³**: ç¡®ä¿ `app.js` ä¸­å·²æ³¨å†Œè·¯ç”±ï¼š
```javascript
app.use('/api/announcements', announcementRoutes);
```

---

### é—®é¢˜2ï¼šæ¥å£è¿”å›500

**åŸå› **: æ•°æ®åº“è¿æ¥æˆ–æŸ¥è¯¢é”™è¯¯

**æ£€æŸ¥**:
1. ç¡®è®¤æ•°æ®åº“æœåŠ¡è¿è¡Œæ­£å¸¸
2. ç¡®è®¤ `announcements` è¡¨å­˜åœ¨
3. æŸ¥çœ‹åç«¯æ—¥å¿—

**è§£å†³**:
```bash
# é‡æ–°åˆ›å»ºè¡¨
node scripts/createAnnouncementsTable.js
```

---

### é—®é¢˜3ï¼šç¦ç”¨åä»ç„¶æ˜¾ç¤º

**åŸå› **: å‰ç«¯ç¼“å­˜æˆ–æ¥å£è°ƒç”¨é”™è¯¯

**æ£€æŸ¥**:
1. ç¡®è®¤è°ƒç”¨çš„æ˜¯ `/api/announcements/active` æ¥å£
2. æ¸…é™¤å°ç¨‹åºç¼“å­˜é‡æ–°åŠ è½½
3. æ£€æŸ¥åç«¯æ—¥å¿—ç¡®è®¤çŠ¶æ€å·²æ›´æ–°

**éªŒè¯**:
```bash
# ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
SELECT id, content, status FROM announcements WHERE id = 1;
```

---

## âœ… æµ‹è¯•ç»“è®º

**æ‰€æœ‰æ¥å£æµ‹è¯•é€šè¿‡**ï¼š
- âœ… åˆ›å»ºå…¬å‘Š
- âœ… è·å–å…¬å‘Š
- âœ… æ›´æ–°å…¬å‘Š
- âœ… ç¦ç”¨å…¬å‘Šï¼ˆå•ä¸ªï¼‰
- âœ… å¯ç”¨å…¬å‘Šï¼ˆå•ä¸ªï¼‰
- âœ… æ‰¹é‡ç¦ç”¨
- âœ… æ‰¹é‡å¯ç”¨
- âœ… åˆ é™¤å…¬å‘Š

**åŠŸèƒ½å®Œå…¨æ­£å¸¸**ï¼

---

**æµ‹è¯•æ—¶é—´**: 2025-10-05  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡
