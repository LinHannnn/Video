# 视频解析接口使用示例

## 🎯 核心接口

### POST `/api/video/parse`

**最简单的使用方式 - 只需要一个 `url` 字段！**

## 📝 请求示例

### 1. 抖音视频
```bash
curl -X POST http://localhost:3000/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url": "https://v.douyin.com/iFRvuEjE/"}'
```

### 2. 哔哩哔哩视频（包含分享文本）
```bash
curl -X POST http://localhost:3000/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url": "【热门视频】https://www.bilibili.com/video/BV1xx4y1Z7zz 超有趣的内容"}'
```

### 3. 小红书视频（包含emoji）
```bash
curl -X POST http://localhost:3000/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url": "😊好棒的视频 https://www.xiaohongshu.com/discovery/item/xxx ✨必看"}'
```

### 4. 快手视频
```bash
curl -X POST http://localhost:3000/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{"url": "https://kuaishou.com/s/abc123def"}'
```

## 📊 响应格式

### 成功响应
```json
{
  "code": 200,
  "msg": "解析成功",
  "data": {
    "platform": "douyin",
    "title": "视频标题",
    "author": "作者名称",
    "duration": "00:30",
    "videoUrl": "https://video.douyin.com/...",
    "coverImage": "https://cover.douyin.com/...",
    "description": "视频描述"
  },
  "exec_time": 1.234,
  "user_ip": "192.168.1.100"
}
```

### 错误响应
```json
{
  "code": 400,
  "msg": "请求参数验证失败",
  "data": null,
  "errors": ["URL不能为空"],
  "exec_time": 0.001,
  "user_ip": "192.168.1.100"
}
```

## 🔧 JavaScript 示例

### 使用 fetch
```javascript
async function parseVideo(url) {
  try {
    const response = await fetch('http://localhost:3000/api/video/parse', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ url })
    });
    
    const result = await response.json();
    
    if (result.code === 200) {
      console.log('解析成功:', result.data);
      return result.data;
    } else {
      console.error('解析失败:', result.msg);
      return null;
    }
  } catch (error) {
    console.error('请求失败:', error);
    return null;
  }
}

// 使用示例
parseVideo('https://v.douyin.com/iFRvuEjE/');
```

### 使用 axios
```javascript
const axios = require('axios');

async function parseVideo(url) {
  try {
    const response = await axios.post('http://localhost:3000/api/video/parse', {
      url: url
    });
    
    console.log('解析成功:', response.data.data);
    return response.data.data;
  } catch (error) {
    if (error.response) {
      console.error('解析失败:', error.response.data.msg);
    } else {
      console.error('请求失败:', error.message);
    }
    return null;
  }
}

// 使用示例
parseVideo('https://v.douyin.com/iFRvuEjE/');
```

## 🌐 Python 示例

```python
import requests
import json

def parse_video(url):
    """解析视频链接"""
    try:
        response = requests.post(
            'http://localhost:3000/api/video/parse',
            headers={'Content-Type': 'application/json'},
            json={'url': url},
            timeout=10
        )
        
        result = response.json()
        
        if result['code'] == 200:
            print('解析成功:', result['data'])
            return result['data']
        else:
            print('解析失败:', result['msg'])
            return None
            
    except requests.RequestException as e:
        print('请求失败:', str(e))
        return None

# 使用示例
parse_video('https://v.douyin.com/iFRvuEjE/')
```

## ✨ 智能特性

### 1. 自动平台识别
系统会根据URL自动识别视频平台：
- `douyin.com` 或 `tiktok.com` → 抖音/TikTok
- `bilibili.com` 或 `b23.tv` → 哔哩哔哩
- `xiaohongshu.com` 或 `xhslink.com` → 小红书
- `kuaishou.com` → 快手

### 2. 智能URL提取
支持从复杂文本中提取URL：
```json
// 原始分享文本
"😊好棒的视频 https://www.xiaohongshu.com/discovery/item/xxx ✨必看"

// 自动提取为（删除https前的所有字符和空格）
"https://www.xiaohongshu.com/discovery/item/xxx ✨必看"
```

### 3. 平台特定处理
不同平台采用不同的请求方式：
- **抖音/TikTok**: GET请求，URL参数格式
- **哔哩哔哩**: GET请求，URL参数格式  
- **小红书**: **JSON格式的POST请求**，特殊URL处理
- **快手**: GET请求，URL参数格式

### 4. 灵活输入格式
支持多种输入格式：
- ✅ 纯URL：`https://v.douyin.com/iFRvuEjE/`
- ✅ 包含标题：`【视频】https://v.douyin.com/iFRvuEjE/`
- ✅ 包含emoji：`😊 https://v.douyin.com/iFRvuEjE/ 👍`
- ✅ 混合文本：`看这个视频 https://v.douyin.com/iFRvuEjE/ 超棒的`

## 🔍 调试和测试

### 查看在线文档
访问 [http://localhost:3000/api/docs](http://localhost:3000/api/docs) 查看Swagger文档

### 健康检查
```bash
curl http://localhost:3000/api/video/health
```

### 支持的平台列表
```bash
curl http://localhost:3000/api/video/platforms
```

## 💡 最佳实践

1. **错误处理**：始终检查响应的 `code` 字段
2. **超时设置**：建议设置10-15秒的请求超时
3. **重试机制**：对于网络错误可以实现简单的重试
4. **日志记录**：记录请求和响应用于调试

## 🚨 注意事项

1. **API密钥**：确保已配置有效的52api.cn密钥
2. **频率限制**：注意第三方API的调用频率限制
3. **网络环境**：确保服务器能访问第三方API服务
4. **URL有效性**：使用有效的视频分享链接进行测试 