# 视频提取后端系统 - 快速启动指南

## 🚀 快速开始

### 第一步：安装依赖

```bash
npm install
```

### 第二步：配置环境变量

复制环境配置文件：
```bash
# Windows
copy config\env.example .env

# macOS/Linux  
cp config/env.example .env
```

编辑 `.env` 文件，修改数据库配置：
```env
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=12345678@
DB_NAME=video_extract_db
```

### 第三步：创建数据库

使用MySQL客户端或phpMyAdmin创建数据库：
```sql
CREATE DATABASE video_extract_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 第四步：启动服务

开发环境：
```bash
npm run dev
```

生产环境：
```bash
npm start
```

### 第五步：验证服务

访问以下地址验证服务是否正常：

- **主页**: http://localhost:3000
- **API文档**: http://localhost:3000/api  
- **健康检查**: http://localhost:3000/api/video/health

## 📋 首次使用步骤

### 1. 添加API密钥

使用Postman或curl添加第三方API密钥：

```bash
curl -X POST http://localhost:3000/api/admin/keys \
  -H "Content-Type: application/json" \
  -d '{
    "keyName": "主密钥",
    "keyValue": "你的52api密钥",
    "description": "主要使用的密钥"
  }'
```

### 2. 测试视频解析

```bash
curl -X POST http://localhost:3000/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{
    "url": "抖音或B站视频分享链接",
    "platform": "auto"
  }'
```

## 🧪 运行测试

系统包含了完整的API测试脚本：

```bash
# 确保服务已启动，然后运行测试
node test/test-api.js
```

测试包括：
- ✅ 健康检查
- ✅ 获取支持平台
- ✅ 密钥管理CRUD
- ✅ 数据验证

## 📊 系统状态检查

### 查看日志
```bash
# 查看应用日志
tail -f logs/combined.log

# 查看错误日志  
tail -f logs/error.log
```

### 监控服务
- 进程状态：确认Node.js进程正在运行
- 数据库连接：检查MySQL服务状态
- 端口占用：确认3000端口未被其他服务占用

## 🔧 常见问题解决

### 问题1：数据库连接失败
```bash
# 检查MySQL服务状态
# Windows
net start mysql

# macOS
brew services start mysql

# Linux
sudo systemctl start mysql
```

### 问题2：端口已被占用
```bash
# 查找占用3000端口的进程
netstat -ano | findstr :3000    # Windows
lsof -i :3000                   # macOS/Linux

# 修改端口（编辑.env文件）
PORT=3001
```

### 问题3：第三方API调用失败
1. 检查API密钥是否有效
2. 确认网络连接正常
3. 查看logs/error.log获取详细错误信息

## 🛠️ 开发模式

开发模式会自动重启服务和显示详细日志：

```bash
# 安装nodemon（如果还没安装）
npm install -g nodemon

# 启动开发模式
npm run dev
```

## 📱 API使用示例

### 获取支持的平台
```bash
curl http://localhost:3000/api/video/platforms
```

### 解析抖音视频
```bash
curl -X POST http://localhost:3000/api/video/parse \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://v.douyin.com/xxxx",
    "platform": "douyin",
    "options": {
      "preferredQuality": "high"
    }
  }'
```

### 管理API密钥
```bash
# 获取密钥列表
curl http://localhost:3000/api/admin/keys

# 更新密钥状态  
curl -X PUT http://localhost:3000/api/admin/keys/1 \
  -H "Content-Type: application/json" \
  -d '{"status": "inactive"}'
```

## 🔒 安全注意事项

1. **生产环境设置**：
   - 修改数据库密码
   - 设置 `NODE_ENV=production`
   - 配置防火墙规则

2. **API密钥保护**：
   - 定期轮换API密钥
   - 监控密钥使用情况
   - 及时删除无效密钥

3. **访问控制**：
   - 管理接口可考虑添加身份验证
   - 设置IP白名单（如需要）
   - 监控异常请求

## 📈 性能优化

1. **数据库优化**：
   - 为常用查询添加索引
   - 定期清理无效数据
   - 调整连接池大小

2. **缓存策略**：
   - 可添加Redis缓存解析结果
   - 缓存支持的平台列表
   - 缓存常用的密钥信息

3. **负载均衡**：
   - 使用PM2集群模式
   - 配置Nginx反向代理
   - 部署多个实例

## 📞 技术支持

如遇到问题，请：

1. 查看 `logs/` 目录下的日志文件
2. 运行测试脚本诊断问题
3. 检查数据库连接和第三方API状态
4. 查看README.md中的常见问题部分

---

🎉 **恭喜！您的视频提取后端系统已经准备就绪！** 